#!/bin/bash

#TODO: rediriger les entr√©es et sorties standards vers ce script


readFile(){
    #-r pour ignorer les caract√®res d'√©chappement
    while read -r LINE; do
        if [ ${LINE%% *} == $1 ]; then
            echo "${LINE#* }"
        fi
    done < "liste-bot.txt"
    echo ""
}


#v√©rifier si le nombre de param√®tres est correct
if [ $# -lt 1 ] || [ $# -gt 2 ]; then #si moins d'un param√®tre ou plus que deux
    #>&2 pour rediriger le message vers la sortie standard d'erreur
    echo "chat-bot destinataire [pseudo]" >&2
    exit 1
fi

#s'il n'y a pas de 2e argument, le r√©ceptionniste sera "bot" par d√©faut
if [ -z "$2" ]; then
    rec="bot"
else
    rec=$2  #receptionniste
fi

dest=$1 #destinataire


#gestion des inputs

read -r input

if [ "$input" == "liste" ]; then
    echo "$(ls)"
elif [ "$input" == "li FICHIER" ]; then
    echo "TODO"
elif [ "$input" == "qui suis-je" ]; then
    echo "$dest"
elif [ "$input" == "au revoir" ]; then
    echo "Au revoir $dest."
    exit 0
else
    ret=$(readFile "$input")
    if [ "$ret" == "" ]; then
        echo "ü§ñ ?"
    else
        echo "$ret"
    fi

fi